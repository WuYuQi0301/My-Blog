---
title: SLAM 非线性优化
date: 2019-03-26 23:30:00
categories:
- SLAM
mathjax: true
---


讨论有噪声的状态中如何进行状态估计：最小二乘法的推导及其数值计算方法。



## 状态估计问题

经典的SLAM模型由一个运动方程和一个观测方程构成：
$$
\left\{\begin{matrix}
x_k = f(x_{k-1},u_k)+w_k\\ 
z_{k,j} = h(y_j,x_k)+v_{k,j}
\end{matrix}\right.
$$
其中

- $u_k$是输入数据，包括测量运动的传感器的数据（通常没有）；

- $x_k$是相机位姿，表示为变换矩阵$T_k$或李代数$exp(\xi^{\wedge}_k)$；

- $z_{k,j}$表示在$x_k$处对路标$y_j$进行一一次观测得到的像素坐标；

- $w_k, v_{k,j}$ 为噪声项，通常假设噪声项满足零均值的高斯分布，即
  $$
  w_k \sim N(0, R_k), v_k\sim N(0,Q_{k,j})
  $$

需要解决的问题是，如何通过带噪声的数据$z$和$u$推断位姿$x$和地图$y$。

### 最大后验和最大似然

进一步从概率论的角度描述这个问题。将所有待估计的变量放在状态变量（集合）中“
$$
x = {x_1,...,x_N,y_1...,y_M}
$$
**已知输入数据u和观测数据z，计算状态x的条件概率分布**:
$$
P(x|z,u) 
$$
经常地，没有运动传感器的时候只考虑观测方程的影响。利用贝叶斯法则有
$$
P(x|z) = \frac{P(z|x)P(x)}{P(z)} \propto P(z|x)P(x)
$$
其中，$P(x|z)$为后验，$P(z|x)$为似然，$P(x)$为先验。直接求解后验概率分布比较困难，于是将问题转换成求一个状态最优估计，使得在该状态下后验概率最大化的**MAP**问题：
$$
x*_{MAP} = arg\ maxP(x|z) = arg\ max\ P(z|x)P(x)
$$
进一步说，当缺少机器人位置的先验知识，问题转化成求解x的最大似然估计**MLE**，即，**求解最可能产生当前观测数据的状态**：
$$
x*_{MLE} = arg\ max\ P(z|x)
$$

### 最小二乘



为了计算这个MLE，首先明确我们已经假设了噪声项服从高斯分布，于是有观测数据的条件概率，即，在位姿$x_k$观测路标$y_j$得到的观测数据$z_{k,j}$，服从以真实值$h$为均值，噪声项的方差为方差的**高斯分布**：
$$
P(z_{k,j}|x_k,y_j) = N(h(y_j, x_k), Q_{k,j} \tag{1}
$$

> 高斯分布的最大似然的求解往往使用**最小化负对数**的方式求解。
>
> 考虑任意高维的高斯分布$x\sim N(\mu, \Sigma)​$，概率密度展开式（pdf）为
> $$
> P(x;\mu,\Sigma) = \frac{1}{\sqrt{(2\pi)^Ndet(\Sigma)}}exp(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu))
> $$
> 取负对数，
> $$
> -ln(P(x;\mu, \Sigma)) = \frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu) + \frac{1}{2}ln((2\pi)^Ndet(\Sigma))
> $$

**对原分布求最大化相当于对负对数求最小化**。而且由于右边第二项与状态x无关，只需最小化右边第一项，于是带入SLAM模型（式1）得到
$$
x* = arg\ min((z_{k,j}-h_{(x_k, y_j)})^TQ^{-1}(z_{k,j}-h_{(x_k,y_j)}))
$$
上式等价于最小化观测方程的噪声项（误差）。现在将运动方程也考虑进来，定义测量值和真实值之间的误差为
$$
\begin{align}
e_{v,k}&=x_k-f(x_{k-1}, u_k)\\
e_{y,j,k}&=z_{k,j} - h(x_k, y_j)
\end{align}
$$


为了使系统整体的误差最小，取误差的平方和（二范数形式度量误差）：
$$
J(x) = \sum_{k}e_{v,k}^TR_{k}e_{v,k}+\sum_k\sum_j e_{y,j,k}^TQ_{k,j}e_{y,j,k}
$$


## 数值解法

迭代法解最小二乘问题

### 高斯牛顿法

### 列文伯格—马夸尔特法